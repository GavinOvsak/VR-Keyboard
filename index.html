<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"> 
	<title>Keyboard Demo</title>
</head>
<body>
<script src="/socket.io/socket.io.js"></script>
<script src="http://www.workbygavin.com/js/lodash.min.js"></script>
<script>
  var socket = io.connect('http://199.223.235.124');
  socket.emit('declare-type', 'output');
</script>
<canvas width="600" height="600" id="board"></canvas>
<div id="code">
</div>
<script>

var canvas = document.getElementById( 'board' );
var c =  canvas.getContext( '2d' );

var width = canvas.width;
var height = canvas.height;

var device_width = width;
var device_height = height;

socket.on('size', function (data) {
	device_width = JSON.parse(data).width;
	device_height = JSON.parse(data).height;
	console.log(data);
});

var points = [];

var repaint = function() {
	c.clearRect(0, 0, width, height);

	drawBackground();

	for (var i = 0; i < points.length; i++) {
		if (!!points[i] && !!points[i].x && !!points[i].y) {
			c.fillStyle = "#555555";
			c.beginPath();
			c.arc(points[i].x*width/device_width, points[i].y*height/device_height, 5, 0, 2*Math.PI);
			c.closePath();
			c.fill();
		}
	}
};

var drawBackground = function(){
	c.fillStyle = "#999999";
	c.beginPath();
	c.rect(175, 175, 50, 50);
	c.rect(275, 175, 50, 50);
	c.rect(375, 175, 50, 50);
	c.rect(175, 275, 50, 50);
	c.rect(275, 275, 50, 50);
	c.rect(375, 275, 50, 50);
	c.rect(175, 375, 50, 50);
	c.rect(275, 375, 50, 50);
	c.rect(375, 375, 50, 50);
	c.closePath();
	c.fill();
}

socket.on('code', function (code) {
	console.log(code);
	screen_code = document.getElementById( 'code' );
	screen_code.text = 'Use this code to connect: ' + code;
});

socket.on('start', function (data) {
	parsed = JSON.parse(data);
	console.log('start');
	console.log(parsed);
	points[parsed.i] = {
		x: parsed.x,
		y: parsed.y
	};
	repaint();
});

socket.on('move', function (data) {
	parsed = JSON.parse(data);
	console.log('move');
	console.log(parsed);
	points[parsed.i] = {
		x: parsed.x,
		y: parsed.y
	};
	repaint();
});

socket.on('end', function (data) {
	parsed = JSON.parse(data);
	console.log('end');
	console.log(parsed);
	points[parsed.i] = {};
	repaint();
});

</script>
</body>
</html>